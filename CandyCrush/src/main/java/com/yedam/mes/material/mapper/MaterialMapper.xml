<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.mes.material.mapper.MaterialMapper">
	<!-- 자재 전체조회 -->
	<select id="mtrlAllList" resultType="MaterialVO">
		SELECT * FROM CM_MTRL_MNG
	</select>
	
	<!-- 업체명조회 -->
	<select id="accountCheck" resultType="AccountVO">
		SELECT ca_no, ca_nm, ca_mng, ca_mng_ph, ca_bsns_num
		FROM CM_ACCOUNT
		WHERE CA_TYP = '매입처'
		ORDER BY ca_no
	</select>
		
	<!-- 모달창 업체검색 -->
	<select id="accountCheckModal" resultType="AccountVO">
		SELECT ca_no, ca_nm, ca_mng, ca_mng_ph, ca_bsns_num
		FROM CM_ACCOUNT
		WHERE CA_TYP = '매입처'
			<if test="caNo != null and !caNo.equals('')">
			AND ca_no LIKE '%' || #{caNo} || '%'
			</if>
			<if test="caNm != null and !caNm.equals('')">
			AND ca_nm LIKE '%' || #{caNm} || '%'
			</if>
		ORDER BY ca_no
	</select>
	
	<!-- 업체명 또는 자재명을 통한 자재검색 -->
	<select id="mtrlSearch" resultType="MaterialVO">
		SELECT cmm.cmm_cd, cmm_nm, cmm_typ, cmm_spec,
		        cmm_unit, cmm_saf_stc, MOT_CNT, MIN_CNT,
		        TO_NUMBER(min_cnt) - TO_NUMBER(mot_cnt) AS "cmm_inven"
		FROM cm_account ca JOIN cm_mtrl_mng cmm
		ON ca.ca_no = cmm.ca_no
		 JOIN cm_mtrl_lot clot
		  ON cmm.cmm_cd = clot.cmm_cd
		    JOIN mtrl_otpt mot
		        ON clot.cml_nm = mot.cml_nm
		            JOIN mtrl_input min
		                ON mot.min_cd = min.min_cd
		WHERE 1 = 1
			<if test="caNm != null and !caNm.equals('')">
			AND ca_nm LIKE '%' || #{caNm} || '%'
			</if>
			<if test="cmmNm != null and !cmmNm.equals('')">
			AND cmm_nm LIKE '%' || #{cmmNm} || '%' 
			</if>
		ORDER BY cmm_cd
	</select>

	<!-- 자재발주 전체조회 -->
	<select id="mtrlOrderAllList" resultType="MaterialOrderVO">
		SELECT * FROM MTRL_ORDR
	</select>
	
	<!-- 자재발주 단건조회 -->
	<select id="mtrlOrderOneCheck" resultType="MaterialOrderVO">
		SELECT mo_cd, mo_title, mo_reo_dt, mo.ca_no, ca_nm, mo.cmm_cd, mo_dlv_dt
		FROM MTRL_ORDR mo JOIN CM_MTRL_MNG cmm
		ON mo.cmm_cd = cmm.cmm_cd
		JOIN CM_ACCOUNT ca
		ON cmm.ca_no = ca.ca_no
		WHERE mo.cmm_cd = #{cmmCd}
	</select>

</mapper>